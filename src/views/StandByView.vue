<template>
    <div class="pt-16" v-if="!trip.id">
        <h1 class="text-xl font-bold text-center text-gray-600">
            Waiting ride request...
        </h1>
        <div class="max-w-sm mx-auto mt-4 overflow-hidden text-left shadow-2xl shadow-gray-800 sm:rounded-md">
            <div class="px-4 py-5 bg-white sm:p-6">
                <img class="self-center w-full mx-auto " src="../assets/samurai.png" alt="samurai">
                <div class="self-center w-1/2 mx-auto ">
                    <svg width="150px" height="150px" viewBox="0 0 1280 430" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="1299198" transform="translate(0.000000, -1.000000)" fill="#550044" fill-rule="nonzero">
                                <g id="Group"
                                    transform="translate(640.600000, 215.600000) scale(-1, 1) rotate(-180.000000) translate(-640.600000, -215.600000) translate(0.600000, 0.600000)">
                                    <path
                                        d="M355.9,428.2 C345.3,425.2 345.8,425.6 345.1,417.1 C344.7,412.9 344.2,409.1 343.9,408.6 C343.3,407.6 319.3,398.1 284.9,385.2 C240.1,368.5 179.7,343.7 167.6,336.9 C159.8,332.6 148.3,327.8 142.6,326.5 C140.3,326 132.8,325.1 126.1,324.6 C119.4,324 109.4,322.7 103.9,321.6 C88.5,318.5 69.9,316.7 47.6,315.9 L27.3,315.3 L23,308.7 C17.1,299.6 17,299.2 20.4,295.7 C24.1,292 24.2,289.2 20.7,280.7 C18.2,274.5 18,272.9 17.6,255.1 L17.2,236.1 L13.4,232.9 C4.3,225.1 0.1,212 0,191.1 C0,171.7 1.1,151.5 2.6,142.9 C3.9,135.8 4,135.5 9.8,130.7 C16.7,124.9 22.8,117.8 25.6,112.3 C32,99.7 79,91.2 164,87.3 L173.2,86.9 L172.6,98.8 C172,113 173.4,124.4 177.5,137.1 C188.7,172.3 216.9,199.3 253.1,209.3 C262.1,211.9 264.3,212.1 280.9,212.1 C297.4,212.1 299.7,211.9 308.7,209.4 C328.8,203.8 344.8,194.2 359.1,179.2 C373.1,164.7 381.3,149.9 386.5,130 C388.6,122.1 388.9,119.1 388.8,102.1 C388.7,89.4 388.2,80.7 387.2,75.8 L385.7,68.5 L686.3,69.2 C851.6,69.6 987,70 987.2,70.1 C987.3,70.2 986.4,73.8 985.2,78.2 C983.3,84.9 983,88.7 983,104.1 C982.9,120.7 983.1,122.8 985.7,132 C997.4,174.1 1032.4,205.6 1074.2,211.7 C1086.1,213.4 1106.7,212.4 1117.4,209.6 C1141.3,203.3 1162.7,189.1 1177.5,169.7 C1184.5,160.5 1192.9,143 1196,131.1 C1198.4,122.3 1198.7,119.2 1198.7,105.1 C1198.8,93.5 1198.3,87 1197.1,81.7 C1196.1,77.6 1195.5,74.2 1195.6,74.1 C1195.8,74 1201.8,74.3 1208.9,74.7 C1235.5,76.3 1254.7,79.2 1261.4,82.6 C1266.2,85 1271.1,90.7 1274.1,97.2 L1276.5,102.4 L1274.9,118.1 C1273.4,133.3 1273.4,134.4 1275.3,146.5 C1281.6,185.3 1280.3,214.5 1271.8,226.7 C1258.4,246 1219.2,260.3 1128.9,278.6 C1055.2,293.5 996.7,299.5 925.6,299.6 C902.8,299.6 903,299.6 890.9,308.1 C872.2,321.2 786.4,368.8 743.8,389.6 C705.5,408.3 665,417.7 599.9,422.8 C579.1,424.5 489.3,424.4 459.9,422.8 C447.8,422.1 428.5,420.9 416.9,420.1 C386.7,417.9 388.3,417.9 382.8,421.1 C368.8,429.2 364.1,430.5 355.9,428.2 Z M544.4,394.9 C545,391.2 548.2,371.1 551.5,350.3 C554.7,329.4 558.1,308.1 559,302.9 C559.9,297.7 560.5,293.3 560.3,293.2 C559.2,292.3 390.4,296.1 365.2,297.6 C344.6,298.9 323.5,301.2 316.7,303 C306.9,305.6 296.9,314.9 291.8,326.1 C288.3,333.6 288.2,343.3 291.3,351.6 C293,356.1 294.3,357.7 298.1,360.2 C306.4,365.6 311.6,368.2 323.4,372.9 C357.5,386.5 409.2,395.9 469.4,399.6 C496.3,401.2 496.4,401.2 520.5,401.4 L543.2,401.6 L544.4,394.9 Z M607.4,399.6 C633.8,397.8 685.1,388.6 710.3,381 C728.9,375.4 754.8,362.2 785.9,342.3 C807,328.9 813.3,324.2 810.9,323.8 C803.4,322.6 797.6,318.8 794.7,313.2 C792.8,309.7 792.6,299.6 794.3,295.3 L795.4,292.6 L704.7,292.8 L614.1,293.1 L608.2,309.1 C597.2,339.3 578.4,396.9 578.4,400.7 C578.4,401.3 587.9,400.9 607.4,399.6 Z"
                                        id="Shape"></path>
                                    <g id="Group-3" transform="translate(177.093964, 0.287301)">
                                        <g id="Group-3-1" transform="rotate(360)">
                                            <path
                                                d="M85.6060359,206.812699 C63.3060359,202.812699 44.6060359,192.712699 28.8060359,176.212699 C15.6060359,162.412699 7.50603591,147.912699 2.60603591,129.512699 C0.406035909,121.212699 0.00603590867,117.612699 0.00603590867,104.812699 C-0.0939640913,87.9126995 1.00603591,81.2126995 6.50603591,66.6126995 C15.2060359,43.6126995 33.6060359,23.0126995 55.8060359,11.5126995 C64.3060359,7.11269948 73.6060359,3.71269948 82.9060359,1.71269948 C93.6060359,-0.587300517 114.106036,-0.587300517 124.806036,1.81269948 C164.006036,10.2126995 194.706036,39.3126995 205.006036,77.9126995 C207.306036,86.5126995 207.606036,89.9126995 207.706036,103.312699 C207.806036,119.112699 207.206036,123.212699 203.106036,136.312699 C193.306036,167.312699 167.606036,193.012699 136.306036,203.212699 C121.306036,208.212699 100.906036,209.612699 85.6060359,206.812699 Z M120.606036,176.712699 C145.506036,171.112699 166.306036,152.012699 174.906036,126.812699 C177.406036,119.612699 177.706036,117.312699 177.706036,104.812699 C177.806036,89.5126995 176.206036,82.0126995 170.306036,70.3126995 C160.906036,51.7126995 142.006036,36.6126995 121.806036,31.7126995 C112.206036,29.3126995 95.0060359,29.3126995 85.8060359,31.7126995 C53.8060359,40.1126995 31.4060359,67.2126995 29.6060359,99.8126995 C27.6060359,135.712699 50.5060359,167.112699 85.4060359,176.312699 C94.8060359,178.712699 110.706036,178.912699 120.606036,176.712699 Z"
                                                id="Shape"></path>
                                            <path
                                                d="M82.3060359,164.012699 C78.7060359,162.712699 73.8060359,160.412699 71.4060359,158.912699 L67.0060359,156.112699 L78.6060359,144.612699 C86.7060359,136.412699 90.6060359,133.212699 91.7060359,133.612699 C93.1060359,134.212699 93.3060359,136.512699 93.3060359,150.312699 C93.3060359,168.912699 93.9060359,168.112699 82.3060359,164.012699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M114.306036,150.412699 C114.306036,136.512699 114.506036,134.212699 115.906036,133.612699 C117.006036,133.212699 120.906036,136.412699 128.906036,144.412699 L140.406036,155.812699 L137.606036,158.012699 C134.206036,160.812699 123.806036,165.012699 118.306036,165.912699 L114.306036,166.612699 L114.306036,150.412699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M50.5060359,139.112699 C47.7060359,135.512699 41.3060359,120.012699 41.3060359,116.612699 C41.3060359,115.612699 44.7060359,115.312699 57.8060359,115.312699 C72.9060359,115.312699 74.3060359,115.412699 74.3060359,117.112699 C74.3060359,118.612699 53.7060359,140.312699 52.2060359,140.312699 C51.8060359,140.312699 51.1060359,139.712699 50.5060359,139.112699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M144.506036,129.412699 C138.306036,123.512699 133.306036,117.912699 133.306036,117.012699 C133.306036,115.512699 135.006036,115.312699 149.806036,115.312699 C162.906036,115.312699 166.306036,115.612699 166.306036,116.612699 C166.306036,120.612699 159.406036,137.112699 156.806036,139.312699 C156.106036,139.912699 152.006036,136.612699 144.506036,129.412699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M100.406036,127.512699 C99.2060359,125.312699 101.506036,121.312699 103.806036,121.312699 C104.606036,121.312699 105.906036,122.312699 106.706036,123.512699 C108.706036,126.312699 107.106036,129.312699 103.806036,129.312699 C102.506036,129.312699 100.906036,128.512699 100.406036,127.512699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M97.2060359,110.412699 C94.0060359,107.112699 93.5060359,103.712699 95.8060359,99.4126995 C98.7060359,93.7126995 106.206036,93.0126995 110.906036,98.0126995 C116.206036,103.712699 111.806036,113.312699 103.806036,113.312699 C101.106036,113.312699 99.4060359,112.512699 97.2060359,110.412699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M79.3060359,106.812699 C76.7060359,103.612699 80.6060359,98.7126995 84.1060359,100.912699 C86.5060359,102.512699 86.8060359,105.412699 84.7060359,107.012699 C82.4060359,108.712699 80.8060359,108.612699 79.3060359,106.812699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M122.906036,106.712699 C120.906036,104.812699 120.906036,102.912699 122.706036,101.312699 C125.006036,99.4126995 128.806036,100.512699 129.106036,103.112699 C129.806036,107.512699 125.906036,109.812699 122.906036,106.712699 Z"
                                                id="Path"></path>
                                            <path
                                                d="M41.3060359,91.8126995 C41.3060359,88.9126995 45.4060359,77.8126995 48.5060359,72.4126995 L51.6060359,67.1126995 L63.3060359,78.8126995 C70.4060359,85.9126995 74.9060359,91.1126995 74.6060359,91.9126995 C74.2060359,93.0126995 70.6060359,93.3126995 57.7060359,93.3126995 C43.6060359,93.3126995 41.3060359,93.1126995 41.3060359,91.8126995 Z"
                                                id="Path"></path>
                                            <path
                                                d="M133.306036,91.5126995 C133.306036,90.6126995 138.406036,84.7126995 144.706036,78.4126995 L156.106036,67.0126995 L159.206036,72.4126995 C162.206036,77.5126995 166.306036,88.9126995 166.306036,91.9126995 C166.306036,93.0126995 163.206036,93.3126995 149.806036,93.3126995 C134.706036,93.3126995 133.306036,93.2126995 133.306036,91.5126995 Z"
                                                id="Path"></path>
                                            <path
                                                d="M100.306036,84.4126995 C99.6060359,82.9126995 99.8060359,82.0126995 101.106036,80.3126995 C104.306036,76.3126995 109.606036,79.9126995 107.306036,84.4126995 C105.906036,86.9126995 101.706036,86.9126995 100.306036,84.4126995 Z"
                                                id="Path"></path>
                                            <path
                                                d="M78.5060359,64.0126995 C72.4060359,57.8126995 67.3060359,52.5126995 67.3060359,52.1126995 C67.3060359,50.3126995 88.1060359,41.3126995 92.2060359,41.3126995 C92.9060359,41.3126995 93.3060359,46.7126995 93.3060359,57.7126995 C93.3060359,71.7126995 93.1060359,74.2126995 91.7060359,74.7126995 C90.8060359,75.0126995 90.1060359,75.3126995 90.0060359,75.3126995 C89.9060359,75.3126995 84.7060359,70.2126995 78.5060359,64.0126995 Z"
                                                id="Path"></path>
                                            <path
                                                d="M115.606036,74.6126995 C114.106036,74.0126995 113.706036,41.3126995 115.206036,41.3126995 C119.806036,41.3126995 140.306036,50.1126995 140.306036,52.1126995 C140.306036,53.0126995 118.006036,75.3126995 117.306036,75.2130348 C117.006036,75.2130348 116.206036,74.9126995 115.606036,74.6126995 Z"
                                                id="Path"></path>
                                            <animateTransform attributeName="transform" attributeType="XML" type="rotate"
                                                from="0 104 104" to="-360 104 104" dur="1s" repeatCount="indefinite" />
                                        </g>
                                    </g>
                                    <g id="Group-2" transform="translate(986.477445, 0.064462)">
                                        <g id="Group-2-1" transform="rotate(360)">
                                            <path
                                                d="M82.9225554,206.435538 C43.9225554,198.035538 13.3225554,168.835538 3.22255538,130.535538 C0.122555378,118.835538 -0.877444622,101.335538 0.822555378,89.4355383 C4.12255538,66.7355383 15.8225554,44.1355383 32.6225554,28.5355383 C59.3225554,3.53553833 96.9225554,-5.86446167 131.922555,3.63553833 C143.622555,6.83553833 160.222555,15.4355383 169.922555,23.2355383 C218.622555,62.8355383 221.722555,136.035538 176.622555,179.235538 C166.922555,188.535538 160.022555,193.235538 147.622555,199.035538 C133.922555,205.435538 124.122555,207.635538 106.922555,208.135538 C94.9225554,208.435538 90.7225554,208.135538 82.9225554,206.435538 Z M127.422555,175.135538 C151.222555,167.035538 168.322555,149.335538 176.022555,124.535538 C179.022555,114.935538 179.322555,95.6355383 176.522555,85.7355383 C165.522555,45.7355383 125.222555,22.0355383 85.4225554,32.1355383 C70.5225554,35.9355383 54.1225554,46.8355383 45.2225554,58.8355383 C27.6225554,82.6355383 24.9225554,112.135538 38.1225554,138.535538 C41.5225554,145.435538 44.1225554,148.835538 51.9225554,156.535538 C59.6225554,164.335538 63.0225554,166.935538 70.0225554,170.435538 C82.9225554,176.935538 90.7225554,178.535538 106.422555,178.135538 C117.322555,177.835538 120.722555,177.435538 127.422555,175.135538 Z"
                                                id="Shape">
                                            </path>
                                            <path
                                                d="M83.2225554,164.535538 C77.8225554,162.635538 67.9225554,157.435538 67.9225554,156.535538 C67.9225554,156.235538 73.0225554,150.835538 79.3225554,144.635538 C87.3225554,136.635538 91.2225554,133.435538 92.3225554,133.835538 C93.7225554,134.335538 93.9225554,136.735538 93.9225554,150.535538 L93.9225554,166.535538 L91.2225554,166.435538 C89.6225554,166.435538 86.0225554,165.535538 83.2225554,164.535538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M114.922555,150.635538 C114.922555,136.735538 115.122555,134.435538 116.522555,133.835538 C118.722555,133.035538 141.222555,155.435538 139.922555,157.035538 C138.222555,159.035538 123.622555,165.435538 119.222555,166.135538 L114.922555,166.835538 L114.922555,150.635538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M49.5225554,136.935538 C46.6225554,132.535538 41.9225554,120.435538 41.9225554,117.535538 C41.9225554,115.635538 42.6225554,115.535538 58.4225554,115.535538 C71.0225554,115.535538 74.9225554,115.835538 74.9225554,116.835538 C74.9225554,117.535538 69.8225554,123.135538 63.5225554,129.435538 L52.1225554,140.835538 L49.5225554,136.935538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M144.222555,129.335538 C138.122555,123.135538 133.322555,117.435538 133.622555,116.835538 C134.222555,115.335538 166.922555,114.935538 166.922555,116.435538 C166.922555,120.935538 158.122555,140.535538 156.122555,140.535538 C155.722555,140.535538 150.422555,135.435538 144.222555,129.335538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M101.122555,128.335538 C99.4225554,126.635538 99.6225554,125.135538 101.822555,123.135538 C103.422555,121.735538 104.122555,121.635538 105.922555,122.535538 C109.022555,124.235538 108.322555,128.935538 104.922555,129.335538 C103.522555,129.535538 101.822555,129.035538 101.122555,128.335538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M97.5225554,110.435538 C90.7225554,102.335538 99.2225554,91.0355383 108.522555,96.0355383 C117.422555,100.835538 114.122555,113.535538 103.922555,113.535538 C100.922555,113.535538 99.5225554,112.935538 97.5225554,110.435538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M79.9225554,107.135538 C78.0225554,104.835538 79.1225554,101.035538 81.7225554,100.735538 C86.1225554,100.035538 88.4225554,103.935538 85.3225554,106.935538 C83.4225554,108.935538 81.5225554,108.935538 79.9225554,107.135538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M123.522555,107.235538 C121.422555,105.635538 121.722555,102.735538 124.222555,101.135538 C127.922555,98.8355383 131.922555,104.635538 128.322555,107.235538 C127.322555,107.935538 126.222555,108.535538 125.922555,108.535538 C125.622555,108.535538 124.522555,107.935538 123.522555,107.235538 Z"
                                                id="Path"></path>
                                            <path
                                                d="M41.9225554,91.5355383 C41.9225554,88.6355383 46.2225554,77.4355383 49.3225554,72.0355383 L52.1225554,67.2355383 L63.7225554,78.8355383 C71.8225554,86.9355383 75.0225554,90.8355383 74.6225554,91.9355383 C74.0225554,93.3355383 71.7225554,93.5355383 57.9225554,93.5355383 C42.7225554,93.5355383 41.9225554,93.4355383 41.9225554,91.5355383 Z"
                                                id="Path"></path>
                                            <path
                                                d="M133.622555,92.3355383 C133.322555,91.6355383 138.322555,85.7355383 144.722555,79.3355383 L156.322555,67.5355383 L159.022555,71.8355383 C161.722555,76.2355383 166.922555,89.5355383 166.922555,92.1355383 C166.922555,93.3355383 164.122555,93.5355383 150.522555,93.5355383 C138.322555,93.5355383 133.922555,93.2355383 133.622555,92.3355383 Z"
                                                id="Path"></path>
                                            <path
                                                d="M101.022555,84.6355383 C99.6225554,82.1355383 100.522555,79.8355383 103.022555,79.0355383 C105.722555,78.1355383 108.122555,80.3355383 107.722555,83.4355383 C107.322555,86.8355383 102.622555,87.7355383 101.022555,84.6355383 Z"
                                                id="Path"></path>
                                            <path
                                                d="M79.1225554,64.2355383 C73.0225554,58.0355383 67.9225554,52.7355383 67.9225554,52.3355383 C67.9225554,50.3355383 88.0225554,41.5355383 92.6225554,41.5355383 C93.6225554,41.5355383 93.9225554,44.9355383 93.9225554,57.9355383 C93.9225554,71.9355383 93.7225554,74.4355383 92.3225554,74.9355383 C91.4225554,75.2355383 90.7225554,75.5355383 90.6225554,75.5355383 C90.5225554,75.5355383 85.3225554,70.4355383 79.1225554,64.2355383 Z"
                                                id="Path"></path>
                                            <path
                                                d="M116.222555,74.8355383 C115.222555,74.5355383 114.922555,70.1355383 114.922555,57.9355383 C114.922555,48.9355383 115.322555,41.5355383 115.722555,41.5355383 C119.322555,41.5355383 134.322555,47.6355383 139.622555,51.3355383 C141.222555,52.3355383 118.022555,75.5355383 116.222555,74.8355383 Z"
                                                id="Path"></path>
                                            <animateTransform attributeName="transform" attributeType="XML" type="rotate"
                                                from="0 104 104" to="-360 104 104" dur="1s" repeatCount="indefinite" />
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>

                </div>


            </div>
        </div>
    </div>
    <div v-else class="pt-16">
        <h1 class="mb-4 text-3xl font-semibold text-center text-gray-800">Trip request</h1>
        <div>
            <div class="max-w-sm mx-auto overflow-hidden text-left shadow-2xl shadow-gray-950 sm:rounded-md">
                <div class="px-3 py-3 bg-white shadow-lg sm:p-6">
                    <div>
                        <GMapMap ref="gMap" :center="trip.destination" :zoom="14" style="width: 100%; height: 270px;">
                        </GMapMap>
                    </div>

                </div>
                <div class="px-4 py-3 mb-6 bg-gray-50 sm:px-6">
                    <div class="w-full text-center ">
                        <p class="text-xl">Going to <strong>{{ trip.destination_name }}</strong></p>
                    </div>
                    <div class="flex flex-row justify-between w-full mt-7">
                        <button @click="handelAcceptTrip"
                            class="inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-black border border-transparent rounded-md shadow-sm hover:bg-gray-600 focus:outline-none">
                            accepet trip</button>
                        <button @click="handelDeclinTrip"
                            class="inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-black border border-transparent rounded-md shadow-sm hover:bg-gray-600 focus:outline-none">
                            cansel </button>
                    </div>
                </div>
            </div>
        </div>


    </div>
</template>
<script setup>
import { onMounted, ref } from 'vue';
import Pusher from 'pusher-js';
import { useTripStore } from '../stores/trip.js';
import { useLocationStore } from '../stores/location.js'
import http from '../helpers/http';
import { useRouter } from 'vue-router';


const location = useLocationStore()
const trip = useTripStore()

let gMap = ref(null)


const handelDeclinTrip = () => {
    trip.reset()
}
const router = useRouter()
const handelAcceptTrip = () => {
    http().post(`/api/trip/${trip.id}/accept`, {
        driver_loction: {
            lat: location.current.geometry.lat,
            lng: location.current.geometry.lng
        }
    }).then((response) => {
        console.log(response.data)
        location.$patch({
            destination: {
                name: 'passenger',
                geometry: response.data.origin
            }
        })
        console.log(location.current.geometry)
        router.push({
            name: 'driving'
        })
    }).catch((error) => {


    })
}


const initMapDirction = () => {
    // draw a path on the map
    if (gMap != null) {
        gMap.value.$mapPromise.then((mapObject) => {
            let originPoint = new google.maps.LatLng(trip.origin)
            let destinationPoint = new google.maps.LatLng(trip.destination)
            let directionsService = new google.maps.DirectionsService
            let directionsDisplay = new google.maps.DirectionsRenderer({
                map: mapObject
            })

            directionsService.route({
                origin: originPoint,
                destination: destinationPoint,
                avoidTolls: false,
                avoidHighways: false,
                travelMode: google.maps.TravelMode.DRIVING
            }, (res, status) => {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(res)
                } else {
                    console.error(status)
                }
            })
        })
    }

}

onMounted(() => {
    location.updateCurrentLocation()
    var pusher = new Pusher("589c07b72e3f4bae8b19", {
        cluster: "mt1",
    });
    var channel = pusher.subscribe("drivers");
    channel.bind("trip.created", (data) => {
        trip.$patch(data.trip)
        initMapDirction()
        console.log('TripCreatedEvent', data)
    });
})
</script>